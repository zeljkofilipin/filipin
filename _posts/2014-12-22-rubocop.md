---
published: false
layout:    post
permalink: rubocop
title:     "RuboCop"
---

![RuboCop logo](https://raw.githubusercontent.com/bbatsov/rubocop/master/logo/rubo-logo-horizontal.png "RuboCop logo")

*[RuboCop logo CC BY-NC 4.0](https://github.com/bbatsov/rubocop#logo)*

# TLDR

RuboCop ([github](https://github.com/bbatsov/rubocop), [rubygems](https://rubygems.org/gems/rubocop), [ruby-toolbox](https://www.ruby-toolbox.com/projects/rubocop)) is a "Ruby static code analyzer". Over 1 million downloads at rubygems.org. According to The Ruby Toolbox, it's popularity has [doubled](https://www.ruby-toolbox.com/projects/rubocop) this year. It is the second most pupular tool in the [code metrics](https://www.ruby-toolbox.com/categories/code_metrics) category.

# Setup

The installation is trivial and explained in the readme file, so I will not cover it here.

Let's pick a Ruby repository and make the code beautiful. For inspiration, let's take a look at [GitHub trending Ruby repositories](https://github.com/trending?l=ruby&since=monthly) for the last month. A few that look interesting are [homebrew](https://github.com/Homebrew/homebrew), [rails](https://github.com/rails/rails), [jekyll](https://github.com/jekyll/jekyll), [discourse](https://github.com/discourse/discourse), [vagrant](https://github.com/mitchellh/vagrant), [metasploit](https://github.com/rapid7/metasploit-framework) and [ruby](https://github.com/ruby/ruby).

The first thing to do (after cloning a repository) is to run `rubocop`, or `bundle exec rubocop` (if you are using Bundler). If you run it in a repository that RuboCop has already cleaned up (for example, *rubocop* repository), output will look similar to this:

{% highlight bash %}
$ bundle exec rubocop
Inspecting 532 files
...
532 files inspected, no offenses detected
{% endhighlight %}

Things get more interesting if you run it in a repository that is not already cleaned up, for example jekyll:

{% highlight bash %}
$ rubocop
Inspecting 95 files
...
95 files inspected, 3930 offenses detected
{% endhighlight %}

3930 offenses! Where to even start? There is a nice command line option:

{% highlight bash %}
--auto-gen-config Generate a configuration file acting as a TODO list.
{% endhighlight %}

Let's try it:

{% highlight bash %}
$ rubocop --auto-gen-config
Inspecting 95 files
...
95 files inspected, 3930 offenses detected
Created .rubocop_todo.yml.
Run `rubocop --config .rubocop_todo.yml`, or
add inherit_from: .rubocop_todo.yml in a .rubocop.yml file.
{% endhighlight %}

Take a look at the file, it should look similar to this:

{% highlight yaml%}
# This configuration was generated by `rubocop --auto-gen-config`
# on 2014-12-22 17:14:22 +0100 using RuboCop version 0.28.0.
# The point is for the user to remove these configuration records
# one by one as the offenses are removed from the code base.
# Note that changes in the inspected code, or installation of new
# versions of RuboCop, may require this file to be generated again.

# Offense count: 1
Lint/AmbiguousOperator:
  Enabled: false
...
{% endhighlight %}

For now we will ignore the contents of the file. RuboCop createad `.rubocop_todo.yml` file that lists all violations. The file on purpose has **todo** in the name, since it is supposed to be short lived, until the problems are resolved, not permanent.

Let's do as suggested. All that needs to be done is to create the permanent configuration file named `.rubocop.yml`. The only contents for now will be a note to inherit everything from the todo file: `inherit_from: .rubocop_todo.yml`.

{% highlight bash %}
$ echo "inherit_from: .rubocop_todo.yml" > .rubocop.yml
{% endhighlight %}

Let's run RuboCop again.

{% highlight bash %}
$ rubocop
Inspecting 95 files
...
95 files inspected, no offenses detected
{% endhighlight %}

At this point, RuboCop ignores all existing offenses, but it would complain if new offenses are introduced. This is a great time for setting up RuboCop to run after every commit to the repository, but let's skip that for now.

# Clean up

The next step is cleaning up. Open the `.rubocop_todo.yml` file and take a closer look. Find an offense with low offense count (ideally 1) that supports `--auto-correct`. This one looks good:

{% highlight yaml%}
# Offense count: 1
# Cop supports --auto-correct.
Lint/DeprecatedClassMethods:
  Enabled: false
{% endhighlight %}

# CI

# Misc

[1 AD to 2003 AD Historical Trends in global distribution of GDP](https://en.wikipedia.org/wiki/File:1_AD_to_2003_AD_Historical_Trends_in_global_distribution_of_GDP_China_India_Western_Europe_USA_Middle_East.png) (China, India, Western Europe, USA, Middle East) is a really interesting graph.
