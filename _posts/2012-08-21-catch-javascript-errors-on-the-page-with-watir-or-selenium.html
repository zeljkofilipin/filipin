---
layout: post
title: Catch JavaScript Errors on the Page with Watir or Selenium
date: 2012-08-21 16:56:09.000000000 +02:00
categories:
- blog
tags:
- code
- selenium
- watir
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _syntaxhighlighter_encoded: '1'
author:
  login: zeljko.filipin
  email: zeljko.filipin@gmail.com
  display_name: "Željko Filipin"
  first_name: "Željko"
  last_name: Filipin
---
<p>[caption id="attachment_525" align="alignnone" width="834"]<img src="/assets/error.png" alt="Javascript Error" title="Javascript Error" width="834" height="551" class="size-full wp-image-525" /> Javascript Error[/caption]</p>
<p><strong>Update</strong>: Looks like there is a simpler way to catch JavaScript errors. See <a href="http://filipin.eu/catch-javascript-errors-on-the-page-with-watir-or-selenium/#comment-415">Jari's comment</a>.</p>
<p>Seven months ago (<a href="http://en.wikipedia.org/wiki/Tempus_fugit">tempus fugit</a>) a client asked if I could create a smoke test that would visit all pages of the application and report if there were any JavaScript errors. Since we already had a smoke test that visited all pages and took screenshots, I thought it would be easy to do. All I had to do was to figure out how to catch JavaScript errors with <a href="http://watir.com/">Watir</a>. Turns out <a href="http://code.google.com/p/selenium/issues/detail?id=148">Selenium does not have API for checking for JavaScript errors</a> on the page yet. How are <a href="http://seleniumhq.org/">Selenium</a> and Watir connected? <a href="http://watirwebdriver.com/">Watir WebDriver</a> (part of Watir project) uses <a href="http://seleniumhq.org/projects/webdriver/">WebDriver</a> (part of Selenium project) to drive browsers.</p>
<p>I have found a solution (with some help at <a href="https://groups.google.com/d/topic/firebug/HkC9SBQjMUo/discussion">Google Groups</a> and <a href="http://stackoverflow.com/q/8541305/17469">Stack Overflow</a>), but it is neither simple nor elegant. I hope that somebody will let me know that there is a way simpler solution.</p>
<p>At the moment following instructions are Mac only, but with minimal changes it should work on Windows or Linux.</p>
<p><strong>Start Apache web server</strong></p>
<ul>
<li>open <em>system preferences &gt; sharing</em>
</li>
<li>enable <em>web sharing</em>
</li>
<li>click <em>Create Personal Website Folder</em> (optional, if it does not exist already)</li>
<li>click <em>Open Personal Website Folder...</em> (or go to <code>/Users/(username)/Sites</code> folder in Finder, example: <code>/Users/zeljko/Sites</code>)</li>
</ul>
<p><strong>Enable PHP</strong></p>
<ul>
<li>open Apache configuration file (<code>/etc/apache2/httpd.conf</code>) in editor (example: <code>sudo nano /etc/apache2/httpd.conf</code>)</li>
<li>
<p>uncomment line 111:</p>
<pre><code>#LoadModule php5_module libexec/apache2/libphp5.so
</code></pre>
</li>
</ul>
<p><strong>Restart Apache</strong></p>
<ul>
<li>go to <em>system preferences &gt; sharing</em>
</li>
<li>disable <em>web sharing</em>
</li>
<li>enable <em>web sharing</em>
</li>
</ul>
<p><strong>Create PHP script and log file</strong></p>
<ul>
<li>crate <code>js.php</code> file and copy it to <code>/Users/(username)/Sites</code>
</li>
</ul>
<p>[code language="php"]<br />
&lt;?php<br />
  $filename = '/Users/Shared/js.log';</p>
<p>  if (!$handle = fopen($filename, 'a'))<br />
  {<br />
    echo 'File &quot;'.$filename.'&quot; could not be opened';<br />
    exit;<br />
  }</p>
<p>  ob_start();<br />
  $content = file_get_contents('php://input');<br />
  $content .= &quot;\n&quot;;<br />
  ob_clean();</p>
<p>  if (!fwrite($handle, $content))<br />
  {<br />
    echo 'Can\'t write into file &quot;'.$filename.'&quot;';<br />
    exit;<br />
  }</p>
<p>  echo 'Done!';<br />
  fclose($handle);<br />
?&gt;<br />
[/code]</p>
<ul>
<li>to check if everything is working, go to <code>http://localhost/~(username)/js.php</code> (example: <code>http://localhost/~zeljko/js.php</code>)</li>
<li>there should be just this text: <code>Done!</code>
</li>
<li>log file should be created at <code>/Users/Shared/js.log</code>
</li>
<li>you can monitor it with: <code>tail -f /Users/Shared/js.log</code>
</li>
</ul>
<p><strong>Set up Firefox</strong></p>
<ul>
<li>install <a href="http://www.mozilla.org/en-US/firefox/new/">Firefox</a></li>
<li>install <a href="http://getfirebug.com/">Firebug</a></li>
<li>install <a href="http://www.softwareishard.com/blog/consoleexport/">ConsoleExport</a></li>
<li>restart Firefox</li>
<li>go to <code>about:config</code>
</li>
<li>in filter enter <code>extensions.firebug.consoleexport.active</code>
</li>
<li>change the value to <code>true</code> (by doubleclicking with mouse, for example)</li>
<li>in filter enter <code>extensions.firebug.consoleexport.serverURL</code>
</li>
<li>change value to <code>http://localhost/~(username)/js.php</code>
</li>
</ul>
<p><strong>Check if errors are logged to log file</strong></p>
<ul>
<li>go to a page with JavaScript error, or open any page and create a JavaScript error in Firebug console</li>
<li>enable Firebug</li>
<li>enable Firebug console</li>
<li>reload page</li>
<li>error message should appear in Firebug console and log file, for example:</li>
</ul>
<p>[code language="xml"]<br />
&lt;log&gt;&lt;class&gt;command&lt;/class&gt;&lt;href&gt;https://www.google.hr/&lt;/href&gt;&lt;/log&gt;<br />
&lt;log&gt;&lt;class&gt;errorMessage&lt;/class&gt;&lt;msg&gt;a is not defined&lt;/msg&gt;&lt;href&gt;https://www.google.hr/&lt;/href&gt;&lt;source&gt;with(_FirebugCommandLine){a};&lt;/source&gt;&lt;/log&gt;<br />
[/code]</p>
<p><strong>Run tests</strong></p>
<ul>
<li>run tests as usual</li>
<li>after the test run, check log file for errors</li>
</ul>
<p>Environment:</p>
<ul>
<li><a href="http://www.apple.com/osx/">Mac OS X</a> 10.7.4</li>
<li><a href="http://www.ruby-lang.org/en/">Ruby</a> 1.9.3p194</li>
<li><a href="https://rubygems.org/gems/selenium-webdriver">selenium-webdriver</a> 2.25.0</li>
<li><a href="https://rubygems.org/gems/watir-webdriver">watir-webdriver</a> 0.6.1</li>
<li><a href="http://www.php.net/">PHP</a> 5.3.10</li>
<li><a href="http://www.apache.org/">Apache</a> 2.2.21</li>
<li><a href="http://www.mozilla.org/en-US/firefox/new/">Firefox</a> 14.0.1</li>
<li><a href="http://getfirebug.com/">Firebug</a> 1.10.2</li>
<li><a href="http://www.softwareishard.com/blog/consoleexport/">ConsoleExport</a> 0.5b5</li>
</ul>
