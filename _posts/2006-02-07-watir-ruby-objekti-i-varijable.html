---
layout: post
title: Watir, Ruby, objekti i varijable
date: 2006-02-07 11:46:41.000000000 +01:00
categories:
- Hrvatski (Croatian)
- Ruby
- Watir
tags:
- code
status: publish
type: post
published: true
meta:
  _edit_last: '3'
  syntaxhighlighter_encoded: '1'
author:
  login: zeljko.filipin
  email: zeljko.filipin@gmail.com
  display_name: "Željko Filipin"
  first_name: "Željko"
  last_name: Filipin
---
<p>Živim od testiranja web aplikacija. Služim se Rubyjem i Watirom za automatiziranje testova funkcionalnosti. Moje skripte su narasle, pa sam napravio mali framework (ne znam kako ovo pametno prevesti) kako bi ih pojednostavnio (sav kod u ovom članku je pojednostavljen i neisproban).</p>
<p>Klasa Page olakšava provjeravanje url-a i tekst(ov)a stranice.</p>
<p>[sourcecode language="ruby"]<br />
class Page<br />
  def initialize(ie, url, texts)<br />
    @ie, @url, @texts = ie, url, texts<br />
  end<br />
  def check<br />
    @texts.each do |text|<br />
      assert(@ie.contains_text(text))<br />
    end<br />
    assert_equal(@url, @ie.url)<br />
  end<br />
end<br />
[/sourcecode]</p>
<p>"Pogledaj element" stranica u aplikaciji koju testiram ima tekst (breadcrumb - opet ne znam kako bi ovo smisleno preveo) <strong>{vrsta_elementa} > View</strong> (primjer: <strong>File > View</strong>)."</p>
<p>Nakon što je element dodan/promijenjen, na toj stranici se nalazi i tekst <strong>{vrsta_elementa} {akcija}.</strong> (primjer: <strong>File added.</strong>).</p>
<p>Klasa File, naravno, testira datoteke.</p>
<p>[sourcecode language="ruby"]<br />
class File<br />
  def initialize<br />
    @page_view = Page.new(<br />
        &quot;app.com/view.aspx&quot;,<br />
        [&quot;File &gt; View&quot;])<br />
    @page_view_after_add = Page.new(<br />
        &quot;app.com/view.aspx&quot;,<br />
        [&quot;File &gt; View&quot;, &quot;File added.&quot;])<br />
    @page_view_after_edit = Page.new(<br />
        &quot;app.com/view.aspx&quot;,<br />
        [&quot;File &gt; View&quot;, &quot;File edited.&quot;])<br />
  end<br />
  def add<br />
    # add file<br />
    @page_view_after_add.check<br />
  end<br />
  def edit<br />
    # edit file<br />
    @page_view_after_edit.check<br />
  end<br />
  def view<br />
    # go to file<br />
    @page_view.check<br />
  end<br />
end<br />
[/sourcecode]</p>
<p>I sve baš lijepo radi. Sve što trebam napisati je ovo.</p>
<p>[sourcecode language="ruby"]<br />
file = File.new<br />
file.add<br />
file.edit<br />
file.view<br />
[/sourcecode]</p>
<p>Postoje tri objekta. Jedan za svaku (@page_view...) varijablu. "id" u "Page:{id}" je različit za svaku varijablu.</p>
<p><code><br />
#&lt;Page:<strong>0x2b5ac28</strong> @url="app.com/view.aspx", @texts=["File &gt; View"]&gt;<br />
#&lt;Page:<strong>0x2b5ab98</strong> @url="app.com/view.aspx", @texts=["File &gt; View", "File added."]&gt;<br />
#&lt;Page:<strong>0x2b5ab08</strong> @url="app.com/view.aspx", @texts=["File &gt; View", "File edited."]&gt;<br />
</code></p>
<p>Ali, dupliciranje me muči.</p>
<p>Želio bi da File#initialize izgleda ovako.</p>
<p>[sourcecode language="ruby"]<br />
@page_view = @page_view_after_add = @page_view_after_edit = Page.new(<br />
  &quot;app.com/view.aspx&quot;,<br />
  [&quot;File &gt; View&quot;])<br />
@page_view_after_add.texts &lt; &lt; &quot;File added.&quot;<br />
@page_view_after_edit.texts &lt;&lt; &quot;File edited.&quot;<br />
[/sourcecode]</p>
<p>Ali (iznenađenje!), to ne radi. Pa, prilično sam novi u objektno orijentiranom svijetu, pa mi to i nije iznenađenje.</p>
<p>Na ovaj način stvoren je samo jedan Page objekt, i sve tri varijable pokazuju na njega. Bez obzira koju varijablu promijenim, ona promijeni objekt na koji pokazuje. Rezultat je da su sve tri varijable iste. To nije ono što sam želio.</p>
<p><code><br />
#&lt;Page:<strong>0x2820048</strong> @url="app.com/view.aspx", @texts=["File &gt; View", "File added.", "File edited."]&gt;<br />
#&lt;Page:<strong>0x2820048</strong> @url="app.com/view.aspx", @texts=["File &gt; View", "File added.", "File edited."]&gt;<br />
#&lt;Page:<strong>0x2820048</strong> @url="app.com/view.aspx", @texts=["File &gt; View", "File added.", "File edited."]&gt;</p>
<p>Isprobao sam nekoliko alternativa, ali niti jedna nije uspjela. Za sad mogu živjeti s duplikacijom, ali bi je volio ukloniti iz mojih skripti.</code></p>
