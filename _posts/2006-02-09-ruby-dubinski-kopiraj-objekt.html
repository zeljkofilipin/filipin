---
layout: post
title: 'Ruby: (Dubinski) Kopiraj objekt'
date: 2006-02-09 13:24:15.000000000 +01:00
---
<p>Želio sam napraviti objekt. Zatim ga kopirati. Zatim promijeniti kopiju bez mijenjanja izvornika. Ali nisam znao kako. Kad god nešto ne znam, pitam <a href="http://www.mail-archive.com/wtr-general%40rubyforge.org/">wtr-general</a> listu. <a href="http://www.mail-archive.com/wtr-general%40rubyforge.org/msg02650.html">Poslao</a> sam pitanje. Pa sam pomislio da bi bilo lijepo kad bi objasnio zašto želim kopirati objekt. Ali, objašnjenje se odužilo, pa sam ga stavio na moj <a href="http://zeljkofilipin.com/2006/02/07/watir-ruby-objects-and-variables/">blog</a>.</p>
<p>Dobio sam odgovor. "Probaj Object#clone". Može li biti tako jednostavno?! Može. Ipak, to je Ruby. Ali ne, nije tako jednostavno. Nije radilo. Izvorni objekt se mijenjao sa svojim duplikatom.</p>
<p>[source:ruby]<br />
class Page<br />
  attr_accessor :texts<br />
  def initialize(url, texts)<br />
    @url, @texts = url, texts<br />
  end<br />
end</p>
<p>page_view = Page.new("app.com/view.aspx", ["File > View"])</p>
<p>page_view_after_add = page_view.clone<br />
page_view_after_add.texts < < "File added."</p>
<p>puts page_view.inspect<br />
puts page_view_after_add.inspect<br />
[/source]</p>
<p>Rezulat:</p>
<p><code><br />
#&lt;Page:0x2820ae0 @url="app.com/view.aspx", @texts=["File &gt; View", "File added."]&gt;<br />
#&lt;Page:0x2820a98 @url="app.com/view.aspx", @texts=["File &gt; View", "File added."]&gt;</p>
<p>Ali sad sam znao gdje gledati. Upisao sam "ri Object#clone" i "ri Object#dup" u Command Prompt (čak sam pogledao i na <a href="http://www.ruby-doc.org/core/">http://www.ruby-doc.org/core/</a>). Kaže (na oba mjesta, i za Object#clone i za Object#dup):</p>
<p>"Proizvodi plitku kopiju objekta - kopiraju se objektove varijable instance (kako ovo prevesti?), ali ne i objekt na kojeg se odnose."</p>
<p>Dakle, stvara "plitku" kopiju. To mi ne treba. Trebam "pravu" kopiju.</p>
<p>Google mi je pomogao. Potražio sam "ruby copy object" i našao <a href="http://www.rubygarden.org/ruby?Make_A_Deep_Copy_Of_An_Object">http://www.rubygarden.org/ruby?Make_A_Deep_Copy_Of_An_Object</a>.</p>
<p>Tajna riječ je "dubinsko" kopiranje.</p>
<p>Dodao sam ovo klasi Page (i zamijenio page_view.clone sa page_view.deep_clone) i dobio sam što sam trebao!</p>
<p>[source:ruby]<br />
def deep_clone<br />
  Marshal::load(Marshal.dump(self))<br />
end<br />
[/source]</p>
<p>Rezulat:</p>
<p><code><br />
#&lt;Page:0x4c1dd10 @url="app.com/view.aspx", @texts=["File &gt; View"]&gt;<br />
#&lt;Page:0x4c1dc50 @url="app.com/view.aspx", @texts=["File &gt; View", "File added."]&gt;<br />
</code></p>
<p>Ne razumijem kako radi, i nije me briga, sve dok radi.</code></p>
